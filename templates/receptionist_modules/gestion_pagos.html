<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestión de Pagos | Recepcionista</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='uploads/icon.png') }}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<link rel="stylesheet" href="{{ url_for('static', filename='css/styles_receptionist/style_gestion_pagos.css') }}">
<script>const ID_USUARIO="{{ session['user']['id_usuario'] if session.get('user') else '' }}";</script>

<style>

</style>
</head>

{% include 'navbar.html' %}

<body>

<div id="main-content" class="container mt-4">
    <div class="card-title-center mb-4"><div class="bi bi-people-fill"> Gestionar de Pagos</div></div>
    
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-white bg-primary mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title"><i class="bi bi-person-check-fill"></i> Miembros Activos</h5>
                            <p class="card-text fs-2" id="totalActivos">0</p>
                        </div>
                        <i class="bi bi-person-badge-fill fs-1 opacity-75"></i>
                    </div>
                    <small class="card-text">Total de miembros con membresía vigente.</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-warning mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title"><i class="bi bi-calendar-x-fill"></i> Vencimientos (0 a 7 días)</h5>
                            <p class="card-text fs-2" id="vencimientosProximos">0</p>
                        </div>
                        <i class="bi bi-bell-fill fs-1 opacity-75"></i>
                    </div>
                    <small class="card-text">Miembros vencidos hace menos de 7 días (periodo de gracia).</small>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-danger mb-3">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title"><i class="bi bi-currency-dollar"></i> Pagos Pendientes</h5>
                            <p class="card-text fs-2" id="pagosVencidos">0</p>
                        </div>
                        <i class="bi bi-credit-card-2-back-fill fs-1 opacity-75"></i>
                    </div>
                    <small class="card-text">Miembros vencidos hace más de 7 días (cobro pendiente).</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-person-lines-fill"></i> Búsqueda Rápida de Estado de Miembro</h5>
                </div>
                <div class="card-body">
                    <form id="formCheckin" class="mb-3">
                        <div class="input-group">
                            <input type="text" id="inputBusqueda" class="form-control" placeholder="Cédula del miembro" aria-label="Buscar Miembro" required>
                            <button class="btn btn-success" type="submit"><i class="bi bi-search"></i> Consultar Estado</button>
                        </div>
                    </form>
                    <div id="resultadoCheckin" class="p-3 border rounded d-none">
                            <p class="mb-1"><strong>Miembro:</strong> <span id="nombreMiembroCheckin" class="fw-bold"></span></p>
                            <p class="mb-1"><strong>ID Miembro:</strong> <span id="idMiembroCheckin" class="text-muted"></span></p>
                            <p class="mb-3"><strong>Estado Membresía:</strong> <span id="estadoMembresia" class="badge badge-estado"></span></p>
                    </div>
                    <hr>
                    <h6><i class="bi bi-file-earmark-person-fill"></i> Inscripción de Nuevos Miembros</h6>
                    <p>Iniciar el proceso de registro y cobro de la primera membresía.</p>
                    <button class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#modalRegistro" id="btnIniciarRegistro"><i class="bi bi-file-earmark-person-fill"></i> Iniciar Registro</button>
                </div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card h-100">
                <div class="card-header bg-light">
                    <h5 class="mb-0"><i class="bi bi-credit-card"></i> Gestión de Pagos y Tareas</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6><i class="bi bi-cash-stack"></i> Procesar Pagos Recurrentes</h6>
                        <p>Cobro de mensualidades o planes de entrenamiento.</p>
                        <button id="btnCobroRapido" class="btn btn-secondary w-100" data-bs-toggle="modal" data-bs-target="#modalRegistro"><i class="bi bi-receipt"></i> Cobro Rápido / Renovación</button>
                    </div>
                    <hr>
                    <h6><i class="bi bi-send-check-fill"></i> Tareas: Alertas y Seguimiento</h6>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Miembros en período de gracia (0 a 7 días):
                            <span class="badge bg-warning rounded-pill" id="badgeVencimientos">0</span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            Miembros en estado Pago Pendiente (> 7 días):
                            <span class="badge bg-danger rounded-pill" id="badgePagosVencidos" data-bs-toggle="modal" data-bs-target="#modalTareasVencidas" style="cursor: pointer;">0</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalRegistro" tabindex="-1" aria-labelledby="modalRegistroLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <h5 class="modal-title" id="modalRegistroLabel">Registro de Membresía y Renovación</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label for="regCedula" class="form-label">Cédula del miembro</label>
                    <div class="input-group">
                        <input type="text" id="regCedula" class="form-control" placeholder="Ingrese Cédula o ID">
                        <button id="btnBuscarModal" class="btn btn-secondary"><i class="bi bi-person-check-fill"></i> Verificar Miembro</button>
                    </div>
                </div>
                <div class="mb-3 p-2 border rounded">
                    <label class="fw-bold d-block">Miembro Verificado:</label>
                    <span id="labelNombreCompleto" class="text-primary"></span>
                </div>
                <hr>
                <form id="formRegistroMembresia">
                    <div class="row g-3">
                        <div class="col-md-4">
                            <label for="regTipoMembresia" class="form-label">Tipo de Membresía</label>
                            <select id="regTipoMembresia" class="form-select">
                                <option value="Mensual">Mensual</option>
                                <option value="Trimestral">Trimestral</option>
                                <option value="Anual">Anual</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="regMonto" class="form-label">Monto ($)</label>
                            <input type="number" id="regMonto" class="form-control" step="0.01" value="0.00">
                        </div>
                        <div class="col-md-4">
                            <label for="regMetodoPago" class="form-label">Método de Pago</label>
                            <select id="regMetodoPago" class="form-select">
                                <option value="Efectivo">Efectivo</option>
                                <option value="Transferencia">Transferencia</option>
                                <option value="Tarjeta">Tarjeta</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="regFechaInicio" class="form-label">Fecha Inicio</label>
                            <input type="date" id="regFechaInicio" class="form-control">
                        </div>
                        <div class="col-md-6">
                            <label for="regFechaFin" class="form-label">Fecha Fin (Automático)</label>
                            <input type="date" id="regFechaFin" class="form-control" disabled>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button id="btnRegistrarMembresia" class="btn btn-primary" disabled><i class="bi bi-file-earmark-plus-fill"></i> Procesar Pago y Membresía</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalTareasVencidas" tabindex="-1" aria-labelledby="modalTareasVencidasLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title" id="modalTareasVencidasLabel"><i class="bi bi-exclamation-triangle-fill"></i> Miembros en Pago Pendiente (> 7 días de Vencimiento)</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="listaPagosVencidos">
                    <p class="text-center text-muted" id="loadingTareas">Cargando lista...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<div id="toastContainer" class="position-fixed p-3 top-0 end-0" style="z-index: 1050;"></div>

{% include 'footer.html' %}

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/funtions_receptionist/gestion_pagos.js') }}"></script>

</body>
</html>